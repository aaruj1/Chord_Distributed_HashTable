# Chord Distributed Hash Table

The objective of this assignment is  to develop the basic functions of the Chord distributed hash table (DHT). 
It uses Apache Thrift interface definition file chord.thrift, that creates service stubs supported by distributed hash table.

## Overview
Example: If ten nodes are in the DHT running on 10 different ports on “128.226.117.49:9090”, ..., “128.226.117.49:9099”, and we want to write the a file “sample.txt”, then the key associated with this file SHA256(“sample.txt”)=“9496...” must be written to the node associated with the next SHA-256 value in the Chord id space. According to the Chord DHT specification (shown in Figure 1), this node is “128.226.117.49:9093’, which has an SHA-256 hash of “c529...”.
Every time the server is started any filesystem or other persistent storage that it used should be initialized to be empty. If your server stores files in the file system, it should use only the current working directory from where it was run. There is no need to implement directory structure.

## Setting up the Environment

### 1. Add the thrift compiler path to your PATH environment variable:

    $> export PATH=$PATH:/home/yaoliu/src_code/local/bin

## Generating stub code, compilation and execution

### 1. Compile the interface definition file chord.thrift

    $> thrift -gen java chord.thrift

### 2. Extended the server-side method stubs generated by Thrift

#### 1. writeFile :  given a filename and contents, the corresponding file should be written to the server. Meta-information, such as the version and content hash (SHA-256 hash of the file content) should also be stored at the server side.
If the filename does not exist on the server, a new file should be created with its version attribute set to 0. Otherwise, the file contents should be overwritten, and the version number should be incremented.
If the server does not own the file’s id, i.e., the server is not the file’s successor, a SystemException should be thrown.

#### 2. readFile :  if a file with a given name exists on the server, both the contents and meta-information should be returned. Otherwise, a SystemException should be thrown and appropriate information indicating the cause of the exception should be included in the SystemException’s message field.
If the server does not own the file’s id, i.e., the server is not the file’s successor, a SystemException should be thrown.

#### 3. setFingertable :  sets the current node’s fingertable to the fingertable provided in the argument of the function. I have provided initialization code (Part 3) that will call this function, but you need to correctly implement this function on the server side.

#### 4. findSucc given an identifier in the DHT’s key space, returns the DHT node that owns the id. This function should be implemented in two parts:
    1. the function should call findPred to discover the DHT node that precedes the given id 
    2. the function should call getNodeSucc to find the successor of this predecessor node

#### 5. findPred : given an identifier in the DHT’s key space, this function should returns the DHT node that immediately precedes the id. This preceeding node is the first node in the counter-clockwise direction in the Chord key space. A SystemException should be thrown if no fingertable exists for the current node.

#### 6. getNodeSucc :  returns the closest DHT node that follows the current node in the Chord key space. A SystemEx- ception should be thrown if no fingertable exists for the current node.


## Steps to Compile and Run the program
### 1. Compile  the code using Makefile which is already present in the repo.
    $> make

### 2. Run the multiple server by providing the different port number 

    $> ./server.sh 8080
    
On start of the server it gives 
Server started at : 
Server NodeID: 
Server IP:
Server Port:

#### Collect the IP and port and put it in the nodes.txt

### 3. Run the initializer program
    $> chmod +x init
    $> ./init nodes.txt

where nodes.txt should contain a list of IP addresses and ports, in the format “<ip-address>:<port>”, of all of the running DHT nodes.
For example, if four DHT nodes are running on remote01.cs.binghamton.edu port 9090, 9091, 9092, and 9093, then nodes.txt should contain:
128.226.114.201:9090
128.226.114.201:9091
128.226.114.201:9092
128.226.114.201:9093

The initializer program will print an error message if any of the specified DHT nodes is not available.

### 4. Run the client by providing it the IP , port number filename and read/write to connect to:
    $> ./client.sh <ip> <port> <filename> <read/write>

## References:
https://pdos.csail.mit.edu/papers/chord:sigcomm01/chord_sigcomm.pdf
